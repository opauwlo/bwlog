const ytRegex=/^.*((youtu.be\/)|(v\/)|(\/u\/\w\/)|(embed\/)|(watch\?))\??v?=?([^#&?]*).*/;function youtubeParser(b){let a=b.match(ytRegex);return a&&11===a[7].length?a[7]:b}const vimeoRegex=/https?:\/\/(?:www\.|player\.)?vimeo.com\/(?:channels\/(?:\w+\/)?|groups\/([^/]*)\/videos\/|album\/(\d+)\/video\/|)(\d+)(?:$|\/|\?)/;function vimeoParser(b){let a=b.match(vimeoRegex);return a&&"string"==typeof a[3]?a[3]:b}const vineRegex=/^http(?:s?):\/\/(?:www\.)?vine\.co\/v\/([a-zA-Z0-9]{1,13}).*/;function vineParser(b){let a=b.match(vineRegex);return a&&11===a[1].length?a[1]:b}const preziRegex=/^https:\/\/prezi.com\/(.[^/]+)/;function preziParser(a){let b=a.match(preziRegex);return b?b[1]:a}const mfrRegex=/^http(?:s?):\/\/(?:www\.)?mfr\.osf\.io\/render\?url=http(?:s?):\/\/osf\.io\/([a-zA-Z0-9]{1,5})\/\?action=download/;function mfrParser(a){let b=a.match(mfrRegex);return b?b[1]:a}const EMBED_REGEX=/@\[([a-zA-Z].+)]\([\s]*(.*?)[\s]*[)]/im;function videoEmbed(a,b){return function(e,n){var l,j,h,c,d=e;let i=e.pos;if(64!==e.src.charCodeAt(i)||91!==e.src.charCodeAt(i+1))return!1;let g=EMBED_REGEX.exec(e.src.slice(e.pos,e.src.length));if(!g||g.length<3)return!1;let k=g[1];c=g[2];let f=k.toLowerCase();if("youtube"===f)c=youtubeParser(c);else if("vimeo"===f)c=vimeoParser(c);else if("vine"===f)c=vineParser(c);else if("prezi"===f)c=preziParser(c);else if("osf"===f)c=mfrParser(c);else if(!b[f])return!1;if(")"===c&&(c=""),j=i+2,l=a.helpers.parseLinkLabel(e,i+1,!1),!n){d.pos=j,d.service=d.src.slice(j,l);let m=new d.md.inline.State(k,d.md,d.env,[]);m.md.inline.tokenize(m),(h=d.push("video","")).videoID=c,h.service=k,h.url=g[2],h.level=d.level}return d.pos+=d.src.indexOf(")",d.pos),!0}}function extractVideoParameters(e){let d=new Map,a=e.replace(/&amp;/gi,"&").split(/[#?&]/);if(a.length>1)for(let b=1;b<a.length;b+=1){let c=a[b].split("=");c.length>1&&d.set(c[0],c[1])}return d}function videoUrl(e,a,f,c){switch(e){case"youtube":{let b=extractVideoParameters(f);c.youtube.parameters&&Object.keys(c.youtube.parameters).forEach(a=>{b.set(a,c.youtube.parameters[a])});let g=b.get("t");if(void 0!==g){let h=0,i=g.match(/[0-9]+/g),j=0;for(;i.length>0;)h+=Number(i.pop())*Math.pow(60,j),j+=1;b.set("start",h),b.delete("t")}b.delete("v"),b.delete("feature"),b.delete("origin");let k=Array.from(b,a=>a.join("=")),l=a.indexOf("?"),d="https://www.youtube";return(c.youtube.nocookie||f.indexOf("youtube-nocookie.com")> -1)&&(d+="-nocookie"),d+=".com/embed/"+(l> -1?a.substr(0,l):a),k.length>0&&(d+="?"+k.join("&")),d}case"vimeo":return"https://player.vimeo.com/video/"+a;case"vine":return"https://vine.co/v/"+a+"/embed/"+c.vine.embed;case"prezi":return"https://prezi.com/embed/"+a+"/?bgcolor=ffffff&amp;lock_to_path=0&amp;autoplay=0&amp;autohide_ctrls=0&amp;landing_data=bHVZZmNaNDBIWnNjdEVENDRhZDFNZGNIUE43MHdLNWpsdFJLb2ZHanI5N1lQVHkxSHFxazZ0UUNCRHloSXZROHh3PT0&amp;landing_sign=1kD6c0N6aYpMUS0wxnQjxzSqZlEB8qNFdxtdjYhwSuI";case"osf":return"https://mfr.osf.io/render?url=https://osf.io/"+a+"/?action=download";default:return e}}function tokenizeVideo(a,b){return function(f,g){var d;let c=a.utils.escapeHtml(f[g].videoID),e=a.utils.escapeHtml(f[g].service).toLowerCase();return"osf"===e&&c?(d=65536*Math.random(),c.match(/http(?:s?):\/\/(?:www\.)?[a-zA-Z0-9-:.]{1,}\/render(?:\/)?[a-zA-Z0-9.&;?=:%]{1,}url=http(?:s?):\/\/[a-zA-Z0-9 -:.]{1,}\/[a-zA-Z0-9]{1,5}\/\?[a-zA-Z0-9.=:%]{1,}/))?'<div id="'+d+'" class="mfr mfr-file"></div><script>$(document).ready(function () {new mfr.Render("'+d+'", "'+c+'");    }); </script>':'<div id="'+d+'" class="mfr mfr-file"></div><script>$(document).ready(function () {new mfr.Render("'+d+'", "https://mfr.osf.io/render?url=https://osf.io/'+c+'/?action=download%26mode=render");    }); </script>':""===c?"":'<div class="embed-responsive embed-responsive-16by9"><iframe class="embed-responsive-item '+e+'-player" type="text/html" width="'+b[e].width+'" height="'+b[e].height+'" src="'+b.url(e,c,f[g].url,b)+'" frameborder="0" webkitallowfullscreen mozallowfullscreen allowfullscreen></iframe></div>'}}const defaults={url:videoUrl,youtube:{width:640,height:390,nocookie:!1},vimeo:{width:500,height:281},vine:{width:600,height:600,embed:"simple"},prezi:{width:550,height:400},osf:{width:"100%",height:"100%"}};module.exports=function(c,d){var a=d,b=c;a?Object.keys(defaults).forEach(function(b){void 0===a[b]&&(a[b]=defaults[b])}):a=defaults,b.renderer.rules.video=tokenizeVideo(b,a),b.inline.ruler.before("emphasis","video",videoEmbed(b,a))}